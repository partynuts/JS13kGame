<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>JS13kGame</title><link rel="stylesheet" type="text/css" href="styles/main.css"><style type="text/css">body,html{background-color:#000;height:100%;margin:0;padding:0;width:100%}#container{border:1px solid #00f;position:relative}.subcanvs{position:absolute}</style></head><body><div class="container"><canvas id="canvas" class="subcanvs"></canvas></div><script type="text/javascript">!function(t){var i={};function e(n){if(i[n])return i[n].exports;var h=i[n]={i:n,l:!1,exports:{}};return t[n].call(h.exports,h,h.exports,e),h.l=!0,h.exports}e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:n})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var h in t)e.d(n,h,function(i){return t[i]}.bind(null,h));return n},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=10)}([,function(t,i,e){t.exports=e.p+"deea435a25f1695af76c2248b4f7f284.png"},function(t,i,e){t.exports=e.p+"29eb3d24e508897596f6967c3057d0c0.png"},function(t,i,e){t.exports=e.p+"57fd7b36660aa2f35a42d99cbc6c5bf3.png"},function(t,i,e){t.exports=e.p+"009bb8395dd8cf7db66d40ca5682ced9.png"},function(t,i,e){t.exports=e.p+"36c3f7c36f5bdd192cdda422584f1bd6.png"},function(t,i,e){t.exports=e.p+"d7c16ed8b6b642499804f66da09f3ce0.png"},function(t,i){zzfx_v=.5,zzfx_x=new AudioContext,zzfx=((t,i,e,n=1,h=.1,s=0,r=0,a=0,o=0)=>{let d=44100,c=Math.PI;e*=2*c/d,e*=1+i*(2*Math.random()-1),s*=1e3*c/d**2,h*=0|(n=0<n?d*(10<n?10:n)|0:1),a*=2*c/d,o*=c,i=[];for(var l=0,f=0,u=0;u<n;++u)i[u]=t*zzfx_v*Math.cos(l*e*Math.cos(f*a+o))*(u<h?u/h:1-(u-h)/(n-h)),l+=1+r*(2*Math.random()-1),f+=1+r*(2*Math.random()-1),e+=s;return t=zzfx_x.createBuffer(1,n,d),e=zzfx_x.createBufferSource(),t.getChannelData(0).set(i),e.buffer=t,e.connect(zzfx_x.destination),e.start(),e})},function(t,i,e){},,function(t,i,e){"use strict";e.r(i);e(7);let n,h,s={};function r(t,...i){s[t]&&s[t].map(t=>t(...i))}function a(){return n}function o(){return h}let d={},c={},l={13:"enter",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down"};function f(t){let i=l[t.which];c[i]=!0,d[i]&&d[i](t)}function u(t){c[l[t.which]]=!1}function y(){c={}}function p(t){return!!c[t]}class m{constructor(t=0,i=0){this._x=t,this._y=i}add(t,i=1){return x(this.x+(t.x||0)*i,this.y+(t.y||0)*i,this)}clamp(t,i,e,n){this._c=!0,this._a=t,this._b=i,this._d=e,this._e=n}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?Math.min(Math.max(this._a,t),this._d):t}set y(t){this._y=this._c?Math.min(Math.max(this._b,t),this._e):t}}function x(t,i,e={}){let n=new m(t,i);return e._c&&(n.clamp(e._a,e._b,e._d,e._e),n.x=t,n.y=i),n}x.prototype=m.prototype,x.class=m;class g{constructor(t){this.init(t)}init(t={}){let{x:i,y:e,dx:n,dy:h,ddx:s,ddy:r,width:a,height:d,image:c}=t;this.position=x(i,e),this.velocity=x(n,h),this.acceleration=x(s,r),this._fx=this._fy=1,this.width=this.height=this.rotation=0,this.ttl=1/0,this.anchor={x:0,y:0},this.context=o();for(let i in t)this[i]=t[i];c&&(this.width=void 0!==a?a:c.width,this.height=void 0!==d?d:c.height),this.sx=0,this.sy=0}get x(){return this.position.x}get y(){return this.position.y}get dx(){return this.velocity.x}get dy(){return this.velocity.y}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}get animations(){return this._a}get viewX(){return this.x-this.sx}get viewY(){return this.y-this.sy}get width(){return this._w}get height(){return this._h}set x(t){this.position.x=t}set y(t){this.position.y=t}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}set animations(t){let i,e;for(i in this._a={},t)this._a[i]=t[i].clone(),e=e||this._a[i];this.currentAnimation=e,this.width=this.width||e.width,this.height=this.height||e.height}set viewX(t){}set viewY(t){}set width(t){let i=t<0?-1:1;this._fx=i,this._w=t*i}set height(t){let i=t<0?-1:1;this._fy=i,this._h=t*i}isAlive(){return this.ttl>0}collidesWith(t){if(this.rotation||t.rotation)return null;let i=this.x-this.width*this.anchor.x,e=this.y-this.height*this.anchor.y,n=t.x,h=t.y;return t.anchor&&(n-=t.width*t.anchor.x,h-=t.height*t.anchor.y),i<n+t.width&&i+this.width>n&&e<h+t.height&&e+this.height>h}update(t){this.advance(t)}render(){this.draw()}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){this.velocity=this.velocity.add(this.acceleration,t),this.position=this.position.add(this.velocity,t),this.ttl--,this.currentAnimation&&this.currentAnimation.update(t)}draw(){let t=-this.width*this.anchor.x,i=-this.height*this.anchor.y;if(this.context.save(),this.context.translate(this.viewX,this.viewY),this.rotation&&this.context.rotate(this.rotation),-1==this._fx||-1==this._fy){let e=this.width/2+t,n=this.height/2+i;this.context.translate(e,n),this.context.scale(this._fx,this._fy),this.context.translate(-e,-n)}this.image?this.context.drawImage(this.image,0,0,this.image.width,this.image.height,t,i,this.width,this.height):this.currentAnimation?this.currentAnimation.render({x:t,y:i,width:this.width,height:this.height,context:this.context}):(this.context.fillStyle=this.color,this.context.fillRect(t,i,this.width,this.height)),this.context.restore()}}function w(t){return new g(t)}w.prototype=g.prototype,w.class=g;class _{constructor({spriteSheet:t,frames:i,frameRate:e,loop:n=!0}={}){this.spriteSheet=t,this.frames=i,this.frameRate=e,this.loop=n;let{width:h,height:s,margin:r=0}=t.frame;this.width=h,this.height=s,this.margin=r,this._f=0,this._a=0}clone(){return v(this)}reset(){this._f=0,this._a=0}update(t=1/60){if(this.loop||this._f!=this.frames.length-1)for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}render({x:t,y:i,width:e=this.width,height:n=this.height,context:h=o()}={}){let s=this.frames[this._f]/this.spriteSheet._f|0,r=this.frames[this._f]%this.spriteSheet._f|0;h.drawImage(this.spriteSheet.image,r*this.width+(2*r+1)*this.margin,s*this.height+(2*s+1)*this.margin,this.width,this.height,t,i,e,n)}}function v(t){return new _(t)}function b(t){if(+t===t)return t;let i=[],e=t.split(".."),n=+e[0],h=+e[1],s=n;if(n<h)for(;s<=h;s++)i.push(s);else for(;s>=h;s--)i.push(s);return i}v.prototype=_.prototype,v.class=_;class M{constructor({image:t,frameWidth:i,frameHeight:e,frameMargin:n,animations:h}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:i,height:e,margin:n},this._f=t.width/i|0,this.createAnimations(h)}createAnimations(t){let i,e;for(e in t){let{frames:n,frameRate:h,loop:s}=t[e];if(i=[],void 0===n)throw Error("Animation "+e+" must provide a frames property");[].concat(n).map(t=>{i=i.concat(b(t))}),this.animations[e]=v({spriteSheet:this,frames:i,frameRate:h,loop:s})}}}function A(t){return new M(t)}A.prototype=M.prototype,A.class=M;const S=()=>{};function R(){let t=a();o().clearRect(0,0,t.width,t.height)}function k(t){return new Promise(i=>{let e=new Image;e.src=t,e.onload=function(){i(e)}})}var z=e(1),E=e.n(z),T=e(2),L=e.n(T),I=e(3),P=e.n(I),W=e(4),C=e.n(W),B=e(5),D=e.n(B),Y=e(6),j=e.n(Y);function q(){const t=function(t,i){const e=document.createElement("canvas");e.width=t,e.height=i;const n=e.getContext("2d");n.beginPath(),n.fillStyle="midnightblue",n.rect(0,0,e.width,e.height),n.fill(),n.beginPath();for(let t=0;t<100;t++){let t=parseInt(Math.random()*e.width),i=parseInt(Math.random()*e.height),h=3*Math.random();n.arc(t,i,h,0,2*Math.PI,!1),n.closePath()}n.fillStyle="yellow",n.fill();const h=document.createElement("img");return h.src=e.toDataURL(),h}(a().width,a().height);return w({x:0,y:0,dx:-1,update(){this.advance(),this.x<=-t.width&&(this.x=0)},render(){this.context.drawImage(t,this.x,0),this.context.drawImage(t,t.width+this.x,0)}})}function O(t){return function(t){const i=a();return w({type:"description",x:0,y:0,height:i.height,width:i.width,opacity:0,render(){this.context.save(),this.context.globalAlpha=this.opacity,this.context.fillStyle=`rgba(0,0,0,${this.opacity})`,this.context.fillRect(this.x,this.y,this.width,this.height),this.context.font="32px Courier New bold",this.context.fillStyle="white",this.context.fillText(t.line1,250,150),this.context.fillText(t.line2,250,190),this.context.fillText(t.line3,250,230),this.context.restore()},update(){this.advance(),this.opacity<.75&&(this.opacity+=.02)}})}(t,a().width,a().height)}(async()=>{let{canvas:t,context:i}=function(t){if(!(n=document.getElementById(t)||t||document.querySelector("canvas")))throw Error("You must provide a canvas element for the game");return(h=n.getContext("2d")).imageSmoothingEnabled=!1,r("init"),{canvas:n,context:h}}();!function(){let t;for(t=0;t<26;t++)l[65+t]=(10+t).toString(36);for(t=0;t<10;t++)l[48+t]=""+t;window.addEventListener("keydown",f),window.addEventListener("keyup",u),window.addEventListener("blur",y)}(),document.querySelectorAll("canvas").forEach(t=>{t.width=window.innerWidth,t.height=window.innerHeight});let e=0,s=3,o=[];const d={line1:"Marty! The DeLorean needs fuel to bring you and Doc Brown back to the future. Be Quick and collect ",line2:"20 energy sticks to get the DeLorean running. But be careful not hit the moon or the sun!",line3:"Click to start!"},c={line1:"You are dead and the world is lost now.",line2:"",line3:"Click to start new game!"},m={line1:"Marty, you made it! The DeLorean is ready to bring you back to the future and save the past.",line2:"But be careful, Biff will not make it easy for you! Let's go!",line3:"Click to start!"};function x(){return o.find(t=>"description"===t.type)}function g(t,i,e){let n=w({type:"nuclearStick",x:t,y:i,width:50,height:50,dx:1.2*Math.random(),dy:1.2*Math.random(),radius:50,update(){x()||this.advance()},collidesWithRound(t){let i=this.x-t.x,e=this.y-t.y;return Math.sqrt(i*i+e*e)<this.radius+t.radius},render(){this.context.save(),this.context.strokeStyle=e,this.context.fillStyle="springgreen",this.context.shadowBlur=10,this.context.shadowColor="springgreen",this.context.fillRect(this.x,this.y,5,20),this.context.beginPath(),this.context.rect(this.x,this.y,5,20),this.context.stroke(),this.context.restore()}});o.push(n)}o.push(q());for(let t=0;t<20;t++)g(200,-10,"springgreen"),g(550,-10,"springgreen");const _=await k(E.a),v=await k(L.a),b=await k(P.a),M=await k(C.a),z=await k(D.a),T=await k(j.a),I=A({image:_,type:"marty",frameWidth:50,frameHeight:52.5,animations:{fly:{frames:"0..2",frameRate:3},fly2:{frames:"0..2",frameRate:3},accelerate:{frames:"4..6",frameRate:3},speedDown1:{frames:"21..23",frameRate:3},flyDown:{frames:"36..38",frameRate:3},flyUp:{frames:"15..17",frameRate:3},salto:{frames:"43..52",frameRate:4,loop:!1},break:{frames:"58..59",frameRate:3},fall:{frames:"96..97",frameRate:4,loop:!1},die:{frames:"99..100",frameRate:4}}}),W=A({image:v,type:"doc",frameWidth:50,frameHeight:52.5,animations:{talk:{frames:"2..3",frameRate:.5}}});function B(t,i,e){const n=w({type:e,x:t,y:i,width:130,height:130,radius:50,dx:-2*Math.random()-1,image:"sun"===e?b:M,update(){x()||(this.__proto__.update.call(this),this.x+this.width<=0&&(this.x=a().width+65,this.y=Math.random()*a().height))}});o.push(n)}function Y(t,i){return t.x<i.x+i.width&&t.x+t.width>i.x&&t.y<i.y+i.height&&t.y+t.height>i.y}for(let t=0;t<5;t++){let t=Math.random()*(.55*window.screen.width)+.3*window.screen.width,i=Math.random()*(.3*window.screen.height)+.5*window.screen.height,e=!0;for(;e;)e=!1,o.filter(t=>"sun"===t.type||"moon"===t.type).forEach(n=>{Y(n,{x:t,y:i,height:300,width:300})&&(e=!0,t-=100,i-=100)});const n=["moon","sun"][Math.round(Math.random())];B(t,i,n)}let H=w({type:"delorean",x:.85*window.screen.width,y:.45*window.screen.height,radius:20,image:z,collidesWithRound(t){let i=this.x-t.x,e=this.y-t.y;return Math.sqrt(i*i+e*e)<this.radius+t.radius},render(){this.draw(),this.image===z&&(this.context.save(),this.context.font="16px Arial",this.context.fillStyle="red",this.context.fillText("Quick Marty, get in!",this.x,this.y-10),this.context.restore())}});function X(t){return t*Math.PI/180}const F=w({type:"marty",x:100,y:500,width:70,height:70,dx:0,dy:0,radius:10,stop(){this.ddx=this.dx=0},stopY(){this.ddy=this.dy=0},collidesWithRound(t){let i=this.x+this.width/2-(t.x+t.width/2),e=this.y+this.height/2-(t.y+t.height/2);return Math.sqrt(i*i+e*e)<this.radius+t.radius},animations:I.animations,update(){if(this.advance(),this.x<=0&&(this.x=0),this.x>=t.width-this.width&&(this.stop(),this.x=t.width-this.width),this.y<=0&&!F.dying&&(this.y=0),this.y>=t.height-this.height&&(this.stopY(),this.y=t.height-this.height),F.dying||F.ouch||x()||F.currentAnimation==F.animations.salto)return;const i=Math.cos(X(this.rotation)),e=Math.sin(X(this.rotation));p("down")?(this.dx=-1,this.dy=1.5,F.playAnimation("flyDown")):p("up")?(this.dx=1,this.dy=-1.5,F.playAnimation("flyUp")):p("space")?(this.dx=1.5,this.dy=-4,setTimeout(()=>{this.dx=1,this.dy=4},1e3),setTimeout(()=>{this.dx=0,this.dy=0,F.playAnimation("fly")},2e3),F.playAnimation("salto"),zzfx(.8,0,220,1,.1,1.2,0,0,0)):(this.dy=0,F.playAnimation("fly")),p("right")?(this.ddx=.05*i,this.ddy=.05*e,zzfx(1,.1,12,.4,.02,1.1,0,0,.22),F.playAnimation("fly"),this.width=70):p("left")?(this.ddx=-.05*i,this.ddy=-.05*e,this.width=-70,F.playAnimation("fly2")):this.ddx=this.ddy=0}}),U=w({type:"doc",x:.8*window.screen.width,y:.4*window.screen.height,width:70,height:70,dx:0,dy:0,animations:W.animations,update(){this.advance(),U.playAnimation("talk")}});function N(){o=o.filter(t=>"description"!==t.type),a().removeEventListener("click",N),F.dying?location.reload():F.level2&&console.log("NEXT LEVEL!")}o.push(F),o.push(O(d)),a().addEventListener("click",N),function({fps:t=60,clearCanvas:i=!0,update:e,render:n}={}){if(!e||!n)throw Error("You must provide update() and render() functions");let h,s,a,o,d,c=0,l=1e3/t,f=1/t,u=i?R:S;function y(){if(s=requestAnimationFrame(y),a=performance.now(),o=a-h,h=a,!(o>1e3)){for(r("tick"),c+=o;c>=l;)d.update(f),c-=l;u(),d.render()}}return d={update:e,render:n,isStopped:!0,start(){h=performance.now(),this.isStopped=!1,requestAnimationFrame(y)},stop(){this.isStopped=!0,cancelAnimationFrame(s)},_frame:y,set _last(t){h=t}}}({update:()=>{2===e&&o.push(H,U);for(let t=0;t<o.length;t++)if("nuclearStick"===o[t].type){for(let i=0;i<o.length;i++)if("marty"===o[i].type){let n=o[t],h=o[i];n.collidesWithRound(h)&&(F.dying||(n.ttl=0,e++,zzfx(1,.1,397,.5,.17,0,.1,0,.17)))}}else if("marty"===o[t].type)for(let i=0;i<o.length;i++)if("sun"===o[i].type||"moon"===o[i].type){let e=o[t],n=o[i];e.x,n.x,e.y,n.y;e.collidesWithRound(n)&&(1===s?(setInterval(()=>{F.dx=0,F.dy=-4,F.playAnimation("die"),F.dying=!0},100),setTimeout(()=>o.push(O(c)),1500),a().addEventListener("click",N)):(F.playAnimation("fall"),s-=1,F.x+=-90*F.dx,F.y-=90*F.dy,F.dx=0,F.ouch=!0,setTimeout(()=>{F.ouch=!1},500),zzfx(1,.1,52,.5,.26,.3,4.4,17.8,.03)))}else if("delorean"===o[i].type){let n=o[t],h=o[i];n.x,h.x,n.y,h.y;e>=2&&H.image===z&&n.collidesWithRound(h)&&(F.ttl=0,F.level2=!0,H.image=T,o=o.filter(t=>t!==U),setTimeout(()=>{H.ddx=.04},500),setTimeout(()=>o.push(O(m)),1500),a().addEventListener("click",N))}(o=o.filter(t=>t.isAlive())).map(t=>t.update())},render:async()=>{o.map(t=>t.render()),i.font="16px Arial",i.fillStyle="deeppink",i.fillText("Score: "+e,8,20),i.font="16px Arial",i.fillStyle="yellow",i.fillText("Life-Energy: "+(F.dying?0:s),100,20)}}).start()})();e(8)}]);</script></body></html>