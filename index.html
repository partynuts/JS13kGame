<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>JS13kGame</title><link rel="stylesheet" type="text/css" href="styles/main.css"><style type="text/css">body,html{background-color:#000;height:100%;margin:0;padding:0;width:100%}#container{border:1px solid #00f;position:relative}.subcanvs{position:absolute}</style></head><body><div class="container"><canvas id="canvas" class="subcanvs"></canvas></div><script type="text/javascript">!function(t){var e={};function i(n){if(e[n])return e[n].exports;var h=e[n]={i:n,l:!1,exports:{}};return t[n].call(h.exports,h,h.exports,i),h.l=!0,h.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var h in t)i.d(n,h,function(e){return t[e]}.bind(null,h));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=10)}([,function(t,e,i){t.exports=i.p+"deea435a25f1695af76c2248b4f7f284.png"},function(t,e,i){t.exports=i.p+"29eb3d24e508897596f6967c3057d0c0.png"},function(t,e,i){t.exports=i.p+"57fd7b36660aa2f35a42d99cbc6c5bf3.png"},function(t,e,i){t.exports=i.p+"009bb8395dd8cf7db66d40ca5682ced9.png"},function(t,e,i){t.exports=i.p+"36c3f7c36f5bdd192cdda422584f1bd6.png"},function(t,e,i){t.exports=i.p+"d7c16ed8b6b642499804f66da09f3ce0.png"},function(t,e){zzfx_v=.5,zzfx_x=new AudioContext,zzfx=((t,e,i,n=1,h=.1,s=0,r=0,o=0,a=0)=>{let d=44100,c=Math.PI;i*=2*c/d,i*=1+e*(2*Math.random()-1),s*=1e3*c/d**2,h*=0|(n=0<n?d*(10<n?10:n)|0:1),o*=2*c/d,a*=c,e=[];for(var l=0,f=0,u=0;u<n;++u)e[u]=t*zzfx_v*Math.cos(l*i*Math.cos(f*o+a))*(u<h?u/h:1-(u-h)/(n-h)),l+=1+r*(2*Math.random()-1),f+=1+r*(2*Math.random()-1),i+=s;return t=zzfx_x.createBuffer(1,n,d),i=zzfx_x.createBufferSource(),t.getChannelData(0).set(e),i.buffer=t,i.connect(zzfx_x.destination),i.start(),i})},function(t,e,i){},,function(t,e,i){"use strict";i.r(e);i(7);let n,h,s={};function r(t,...e){s[t]&&s[t].map(t=>t(...e))}function o(){return n}function a(){return h}let d={},c={},l={13:"enter",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down"};function f(t){let e=l[t.which];c[e]=!0,d[e]&&d[e](t)}function u(t){c[l[t.which]]=!1}function y(){c={}}function p(t){return!!c[t]}class x{constructor(t=0,e=0){this._x=t,this._y=e}add(t,e=1){return m(this.x+(t.x||0)*e,this.y+(t.y||0)*e,this)}clamp(t,e,i,n){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=n}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?Math.min(Math.max(this._a,t),this._d):t}set y(t){this._y=this._c?Math.min(Math.max(this._b,t),this._e):t}}function m(t,e,i={}){let n=new x(t,e);return i._c&&(n.clamp(i._a,i._b,i._d,i._e),n.x=t,n.y=e),n}m.prototype=x.prototype,m.class=x;class g{constructor(t){this.init(t)}init(t={}){let{x:e,y:i,dx:n,dy:h,ddx:s,ddy:r,width:o,height:d,image:c}=t;this.position=m(e,i),this.velocity=m(n,h),this.acceleration=m(s,r),this._fx=this._fy=1,this.width=this.height=this.rotation=0,this.ttl=1/0,this.anchor={x:0,y:0},this.context=a();for(let e in t)this[e]=t[e];c&&(this.width=void 0!==o?o:c.width,this.height=void 0!==d?d:c.height),this.sx=0,this.sy=0}get x(){return this.position.x}get y(){return this.position.y}get dx(){return this.velocity.x}get dy(){return this.velocity.y}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}get animations(){return this._a}get viewX(){return this.x-this.sx}get viewY(){return this.y-this.sy}get width(){return this._w}get height(){return this._h}set x(t){this.position.x=t}set y(t){this.position.y=t}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}set animations(t){let e,i;for(e in this._a={},t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}set viewX(t){}set viewY(t){}set width(t){let e=t<0?-1:1;this._fx=e,this._w=t*e}set height(t){let e=t<0?-1:1;this._fy=e,this._h=t*e}isAlive(){return this.ttl>0}collidesWith(t){if(this.rotation||t.rotation)return null;let e=this.x-this.width*this.anchor.x,i=this.y-this.height*this.anchor.y,n=t.x,h=t.y;return t.anchor&&(n-=t.width*t.anchor.x,h-=t.height*t.anchor.y),e<n+t.width&&e+this.width>n&&i<h+t.height&&i+this.height>h}update(t){this.advance(t)}render(){this.draw()}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){this.velocity=this.velocity.add(this.acceleration,t),this.position=this.position.add(this.velocity,t),this.ttl--,this.currentAnimation&&this.currentAnimation.update(t)}draw(){let t=-this.width*this.anchor.x,e=-this.height*this.anchor.y;if(this.context.save(),this.context.translate(this.viewX,this.viewY),this.rotation&&this.context.rotate(this.rotation),-1==this._fx||-1==this._fy){let i=this.width/2+t,n=this.height/2+e;this.context.translate(i,n),this.context.scale(this._fx,this._fy),this.context.translate(-i,-n)}this.image?this.context.drawImage(this.image,0,0,this.image.width,this.image.height,t,e,this.width,this.height):this.currentAnimation?this.currentAnimation.render({x:t,y:e,width:this.width,height:this.height,context:this.context}):(this.context.fillStyle=this.color,this.context.fillRect(t,e,this.width,this.height)),this.context.restore()}}function w(t){return new g(t)}w.prototype=g.prototype,w.class=g;class _{constructor({spriteSheet:t,frames:e,frameRate:i,loop:n=!0}={}){this.spriteSheet=t,this.frames=e,this.frameRate=i,this.loop=n;let{width:h,height:s,margin:r=0}=t.frame;this.width=h,this.height=s,this.margin=r,this._f=0,this._a=0}clone(){return v(this)}reset(){this._f=0,this._a=0}update(t=1/60){if(this.loop||this._f!=this.frames.length-1)for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}render({x:t,y:e,width:i=this.width,height:n=this.height,context:h=a()}={}){let s=this.frames[this._f]/this.spriteSheet._f|0,r=this.frames[this._f]%this.spriteSheet._f|0;h.drawImage(this.spriteSheet.image,r*this.width+(2*r+1)*this.margin,s*this.height+(2*s+1)*this.margin,this.width,this.height,t,e,i,n)}}function v(t){return new _(t)}function b(t){if(+t===t)return t;let e=[],i=t.split(".."),n=+i[0],h=+i[1],s=n;if(n<h)for(;s<=h;s++)e.push(s);else for(;s>=h;s--)e.push(s);return e}v.prototype=_.prototype,v.class=_;class S{constructor({image:t,frameWidth:e,frameHeight:i,frameMargin:n,animations:h}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:e,height:i,margin:n},this._f=t.width/e|0,this.createAnimations(h)}createAnimations(t){let e,i;for(i in t){let{frames:n,frameRate:h,loop:s}=t[i];if(e=[],void 0===n)throw Error("Animation "+i+" must provide a frames property");[].concat(n).map(t=>{e=e.concat(b(t))}),this.animations[i]=v({spriteSheet:this,frames:e,frameRate:h,loop:s})}}}function M(t){return new S(t)}M.prototype=S.prototype,M.class=S;const A=()=>{};function R(){let t=o();a().clearRect(0,0,t.width,t.height)}function I(t){return new Promise(e=>{let i=new Image;i.src=t,i.onload=function(){e(i)}})}var z=i(1),k=i.n(z),E=i(2),T=i.n(E),P=i(3),O=i.n(P),L=i(4),C=i.n(L),W=i(5),D=i.n(W),Y=i(6),j=i.n(Y);function q(){const t=function(t,e){const i=document.createElement("canvas");i.width=t,i.height=e;const n=i.getContext("2d");n.beginPath(),n.fillStyle="midnightblue",n.rect(0,0,i.width,i.height),n.fill(),n.beginPath();for(let t=0;t<100;t++){let t=parseInt(Math.random()*i.width),e=parseInt(Math.random()*i.height),h=3*Math.random();n.arc(t,e,h,0,2*Math.PI,!1),n.closePath()}n.fillStyle="yellow",n.fill();const h=document.createElement("img");return h.src=i.toDataURL(),h}(o().width,o().height);return w({x:0,y:0,dx:-1,update(){this.advance(),this.x<=-t.width&&(this.x=0)},render(){this.context.drawImage(t,this.x,0),this.context.drawImage(t,t.width+this.x,0)}})}function B(t){return function(t){const e=o();return w({type:"description",x:0,y:0,height:e.height,width:e.width,opacity:0,render(){this.context.save(),this.context.globalAlpha=this.opacity,this.context.fillStyle=`rgba(0,0,0,${this.opacity})`,this.context.fillRect(this.x,this.y,this.width,this.height),this.context.font="32px Courier New bold",this.context.fillStyle="white",this.context.fillText(t.line1,250,150),this.context.fillText(t.line2,250,190),this.context.fillText(t.line3,250,230),this.context.restore()},update(){this.advance(),this.opacity<.75&&(this.opacity+=.02)}})}(t,o().width,o().height)}(async()=>{let{canvas:t,context:e}=function(t){if(!(n=document.getElementById(t)||t||document.querySelector("canvas")))throw Error("You must provide a canvas element for the game");return(h=n.getContext("2d")).imageSmoothingEnabled=!1,r("init"),{canvas:n,context:h}}();!function(){let t;for(t=0;t<26;t++)l[65+t]=(10+t).toString(36);for(t=0;t<10;t++)l[48+t]=""+t;window.addEventListener("keydown",f),window.addEventListener("keyup",u),window.addEventListener("blur",y)}(),document.querySelectorAll("canvas").forEach(t=>{t.width=window.innerWidth,t.height=window.innerHeight});let i=0,s=3,a=[];const d={line1:"Marty! The DeLorean needs fuel to bring you and Doc Brown back. Be Quick and collect 20 energy sticks",line2:"to get the DeLorean running. But be careful not hit the moon or the sun!",line3:"Click to start!"},c={line1:"You are dead and the world is lost now.",line2:"",line3:"Click to start new game!"};function x(){return a.find(t=>"description"===t.type)}function m(t,e,i){let n=w({type:"nuclearStick",x:t,y:e,width:50,height:50,dx:1.2*Math.random(),dy:1.2*Math.random(),radius:50,update(){x()||this.advance()},collidesWithRound(t){let e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)<this.radius+t.radius},render(){this.context.save(),this.context.strokeStyle=i,this.context.fillStyle="springgreen",this.context.shadowBlur=10,this.context.shadowColor="springgreen",this.context.fillRect(this.x,this.y,5,20),this.context.beginPath(),this.context.rect(this.x,this.y,5,20),this.context.stroke(),this.context.restore()}});a.push(n)}console.log("DESC",d),a.push(q());for(let t=0;t<20;t++)m(200,-10,"springgreen"),m(550,-10,"springgreen");const g=await I(k.a),_=await I(T.a),v=await I(O.a),b=await I(C.a),S=await I(D.a),z=await I(j.a),E=M({image:g,type:"marty",frameWidth:50,frameHeight:52.5,animations:{fly:{frames:"0..2",frameRate:3},fly2:{frames:"0..2",frameRate:3},accelerate:{frames:"4..6",frameRate:3},speedDown1:{frames:"21..23",frameRate:3},flyDown:{frames:"36..38",frameRate:3},flyUp:{frames:"15..17",frameRate:3},salto:{frames:"43..52",frameRate:4,loop:!1},break:{frames:"58..59",frameRate:3},fall:{frames:"96..97",frameRate:4,loop:!1},die:{frames:"99..100",frameRate:4}}}),P=M({image:_,type:"doc",frameWidth:50,frameHeight:52.5,animations:{talk:{frames:"2..3",frameRate:.5}}});function L(t,e,i){const n=w({type:i,x:t,y:e,width:130,height:130,radius:50,dx:-2*Math.random()-1,image:"sun"===i?v:b,update(){x()||(this.__proto__.update.call(this),this.x+this.width<=0&&(this.x=o().width+65,this.y=Math.random()*o().height))}});a.push(n)}function W(t,e){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y}for(let t=0;t<5;t++){let t=Math.random()*(.55*window.screen.width)+.3*window.screen.width,e=Math.random()*(.3*window.screen.height)+.5*window.screen.height,i=!0;for(;i;)i=!1,a.filter(t=>"sun"===t.type||"moon"===t.type).forEach(n=>{W(n,{x:t,y:e,height:300,width:300})&&(i=!0,t-=100,e-=100)});const n=["moon","sun"][Math.round(Math.random())];L(t,e,n)}let Y=w({type:"delorean",x:.85*window.screen.width,y:.45*window.screen.height,radius:20,image:S,collidesWithRound(t){let e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)<this.radius+t.radius},render(){this.draw(),this.image===S&&(this.context.save(),this.context.font="16px Arial",this.context.fillStyle="red",this.context.fillText("Quick Marty, get in!",this.x,this.y-10),this.context.restore())}});function H(t){return t*Math.PI/180}const N=w({type:"marty",x:100,y:500,width:70,height:70,dx:0,dy:0,radius:10,stop(){this.dx=0,this.ddx=0},stopY(){this.dy=0,this.ddy=0,console.log("stop2")},collidesWithRound(t){let e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)<this.radius+t.radius},animations:E.animations,update(){if(this.advance(),this.x<=0&&(this.x=0),this.x>=window.screen.width-this.width&&(console.log("POSITION",window.screen.width,this.x),this.stop(),this.x=window.screen.width-this.width),this.y<=0&&!N.dying&&(this.y=0),this.y>=window.screen.height-this.height&&(console.log("POSITION",window.screen.height,this.y),this.stopY(),this.y=window.screen.height-this.height),N.dying||N.ouch||x())return;const t=Math.cos(H(this.rotation)),e=Math.sin(H(this.rotation));if(p("down"))this.x+=-1,this.y+=1.5,N.playAnimation("flyDown");else if(p("up"))this.x+=1,this.y+=-1.5,N.playAnimation("flyUp");else if(p("space")){let i=setInterval(()=>{this.y+=-4,this.ddx=.1*t,this.ddy=.1*e},100),n=setInterval(()=>{this.x+=1,this.y+=1.5,this.ddx=.1*t,this.ddy=.1*e},100);setTimeout(()=>clearInterval(i),1e3),setTimeout(()=>n(),1e3),setTimeout(()=>clearInterval(n),2e3),N.playAnimation("salto"),zzfx(.8,0,220,1,.1,1.2,0,0,0)}p("right")?(this.ddx=.05*t,this.ddy=.05*e,zzfx(1,.1,12,.4,.02,1.1,0,0,.22),N.playAnimation("fly"),this.width=70):p("left")?(this.ddx=-.05*t,this.ddy=-.05*e,this.width=-70,N.playAnimation("fly2")):this.ddx=this.ddy=0}}),F=w({type:"doc",x:.8*window.screen.width,y:.4*window.screen.height,width:70,height:70,dx:0,dy:0,animations:P.animations,update(){this.advance(),F.playAnimation("talk")}});function U(){a=a.filter(t=>"description"!==t.type),o().removeEventListener("click",U),N.dying&&location.reload()}a.push(N),a.push(B(d)),o().addEventListener("click",U),function({fps:t=60,clearCanvas:e=!0,update:i,render:n}={}){if(!i||!n)throw Error("You must provide update() and render() functions");let h,s,o,a,d,c=0,l=1e3/t,f=1/t,u=e?R:A;function y(){if(s=requestAnimationFrame(y),o=performance.now(),a=o-h,h=o,!(a>1e3)){for(r("tick"),c+=a;c>=l;)d.update(f),c-=l;u(),d.render()}}return d={update:i,render:n,isStopped:!0,start(){h=performance.now(),this.isStopped=!1,requestAnimationFrame(y)},stop(){this.isStopped=!0,cancelAnimationFrame(s)},_frame:y,set _last(t){h=t}}}({update:()=>{2===i&&a.push(Y,F);for(let t=0;t<a.length;t++)if("nuclearStick"===a[t].type){for(let e=0;e<a.length;e++)if("marty"===a[e].type){let n=a[t],h=a[e];n.collidesWithRound(h)&&(N.dying||(n.ttl=0,i++,zzfx(1,.1,397,.5,.17,0,.1,0,.17)))}}else if("marty"===a[t].type)for(let e=0;e<a.length;e++)if("sun"===a[e].type||"moon"===a[e].type){let i=a[t],n=a[e];i.x,n.x,i.y,n.y;i.collidesWithRound(n)&&(console.log("COLLISION"),1===s?(setInterval(()=>{N.dx=0,N.dy=-4,N.playAnimation("die"),N.dying=!0},100),setTimeout(()=>a.push(B(c)),1500),o().addEventListener("click",U)):(N.playAnimation("fall"),s-=1,N.x=n.x-300,N.dx=0,N.ouch=!0,setTimeout(()=>{N.ouch=!1},500),zzfx(1,.1,52,.5,.26,.3,4.4,17.8,.03)))}else if("delorean"===a[e].type){let n=a[t],h=a[e];n.x,h.x,n.y,h.y;i>=2&&Y.image===S&&n.collidesWithRound(h)&&(N.ttl=0,Y.image=z,a=a.filter(t=>t!==F),setTimeout(()=>{Y.ddx=.04},500))}(a=a.filter(t=>t.isAlive())).map(t=>t.update())},render:async()=>{a.map(t=>t.render()),e.font="16px Arial",e.fillStyle="deeppink",e.fillText("Score: "+i,8,20),e.font="16px Arial",e.fillStyle="yellow",e.fillText("Life-Energy: "+(N.dying?0:s),100,20)}}).start()})();i(8)}]);</script></body></html>