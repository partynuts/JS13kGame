<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>JS13kGame</title><link rel="stylesheet" type="text/css" href="styles/main.css"><style type="text/css">body,html{background-color:#000;height:100%;margin:0;padding:0;width:100%}#container{border:1px solid #00f;position:relative}.subcanvs{position:absolute}</style></head><body><div class="container"><canvas id="canvas" class="subcanvs"></canvas></div><script type="text/javascript">!function(t){var e={};function i(n){if(e[n])return e[n].exports;var h=e[n]={i:n,l:!1,exports:{}};return t[n].call(h.exports,h,h.exports,i),h.l=!0,h.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var h in t)i.d(n,h,function(e){return t[e]}.bind(null,h));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=11)}([,function(t,e,i){t.exports=i.p+"ed38803ff00f0c4bcd8c47b3b21e72a4.png"},function(t,e,i){t.exports=i.p+"38e21d0ac1db52bcffc0613e4a479ab4.png"},function(t,e,i){t.exports=i.p+"92944ba0567ede019ab6a8a12a489ed7.png"},function(t,e,i){t.exports=i.p+"7c46ef2c40aed32f7c70ce9c45789eb0.png"},function(t,e,i){t.exports=i.p+"f8aceaf519c8868600b5009460acca5c.png"},function(t,e,i){t.exports=i.p+"1335f293d428c8961492dadf2c86e828.png"},function(t,e){zzfx_v=.5,zzfx_x=new AudioContext,zzfx=((t,e,i,n=1,h=.1,r=0,s=0,a=0,o=0)=>{let c=44100,l=Math.PI;i*=2*l/c,i*=1+e*(2*Math.random()-1),r*=1e3*l/c**2,h*=0|(n=0<n?c*(10<n?10:n)|0:1),a*=2*l/c,o*=l,e=[];for(var d=0,f=0,u=0;u<n;++u)e[u]=t*zzfx_v*Math.cos(d*i*Math.cos(f*a+o))*(u<h?u/h:1-(u-h)/(n-h)),d+=1+s*(2*Math.random()-1),f+=1+s*(2*Math.random()-1),i+=r;return t=zzfx_x.createBuffer(1,n,c),i=zzfx_x.createBufferSource(),t.getChannelData(0).set(e),i.buffer=t,i.connect(zzfx_x.destination),i.start(),i})},function(t,e,i){t.exports=i.p+"ce241ea7b732ad4cb4119e75856574e7.png"},function(t,e,i){},,function(t,e,i){"use strict";i.r(e);i(7);let n,h,r={};function s(t,...e){r[t]&&r[t].map(t=>t(...e))}function a(){return n}function o(){return h}let c={},l={},d={13:"enter",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down"};function f(t){let e=d[t.which];l[e]=!0,c[e]&&c[e](t)}function u(t){l[d[t.which]]=!1}function p(){l={}}function m(t){return!!l[t]}class y{constructor(t=0,e=0){this._x=t,this._y=e}add(t,e=1){return x(this.x+(t.x||0)*e,this.y+(t.y||0)*e,this)}clamp(t,e,i,n){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=n}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?Math.min(Math.max(this._a,t),this._d):t}set y(t){this._y=this._c?Math.min(Math.max(this._b,t),this._e):t}}function x(t,e,i={}){let n=new y(t,e);return i._c&&(n.clamp(i._a,i._b,i._d,i._e),n.x=t,n.y=e),n}x.prototype=y.prototype,x.class=y;class g{constructor(t){this.init(t)}init(t={}){let{x:e,y:i,dx:n,dy:h,ddx:r,ddy:s,width:a,height:c,image:l}=t;this.position=x(e,i),this.velocity=x(n,h),this.acceleration=x(r,s),this.width=this.height=this.rotation=0,this.ttl=1/0,this.anchor={x:0,y:0},this.context=o();for(let e in t)this[e]=t[e];l&&(this.width=void 0!==a?a:l.width,this.height=void 0!==c?c:l.height)}get x(){return this.position.x}get y(){return this.position.y}get dx(){return this.velocity.x}get dy(){return this.velocity.y}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}get animations(){return this._a}set x(t){this.position.x=t}set y(t){this.position.y=t}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}set animations(t){let e,i;for(e in this._a={},t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}isAlive(){return this.ttl>0}collidesWith(t){if(this.rotation||t.rotation)return null;let e=this.x-this.width*this.anchor.x,i=this.y-this.height*this.anchor.y,n=t.x,h=t.y;return t.anchor&&(n-=t.width*t.anchor.x,h-=t.height*t.anchor.y),e<n+t.width&&e+this.width>n&&i<h+t.height&&i+this.height>h}update(t){this.advance(t)}render(){this.draw()}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){this.velocity=this.velocity.add(this.acceleration,t),this.position=this.position.add(this.velocity,t),this.ttl--,this.currentAnimation&&this.currentAnimation.update(t)}draw(){let t=-this.width*this.anchor.x,e=-this.height*this.anchor.y;this.context.save(),this.context.translate(this.x,this.y),this.rotation&&this.context.rotate(this.rotation),this.image?this.context.drawImage(this.image,0,0,this.image.width,this.image.height,t,e,this.width,this.height):this.currentAnimation?this.currentAnimation.render({x:t,y:e,width:this.width,height:this.height,context:this.context}):(this.context.fillStyle=this.color,this.context.fillRect(t,e,this.width,this.height)),this.context.restore()}}function w(t){return new g(t)}w.prototype=g.prototype,w.class=g;class v{constructor({spriteSheet:t,frames:e,frameRate:i,loop:n=!0,flipX:h=!1,flipY:r=!1}={}){this.spriteSheet=t,this.frames=e,this.frameRate=i,this.loop=n,this.flipX=h,this.flipY=r;let{width:s,height:a,margin:o=0}=t.frame;this.width=s,this.height=a,this.margin=o,this._f=0,this._a=0}clone(){return _(this)}reset(){this._f=0,this._a=0}update(t=1/60){if(this.loop||this._f!=this.frames.length-1)for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}render({x:t,y:e,width:i=this.width,height:n=this.height,context:h=o()}={}){let r=this.frames[this._f]/this.spriteSheet._f|0,s=this.frames[this._f]%this.spriteSheet._f|0;h.save(),h.scale(this.flipX?-1:1,this.flipY?-1:1),h.drawImage(this.spriteSheet.image,s*this.width+(2*s+1)*this.margin,r*this.height+(2*r+1)*this.margin,this.width,this.height,t+this.flipX?-i:0,e+this.flipY?-n:0,i,n),h.restore()}}function _(t){return new v(t)}function b(t){if(+t===t)return t;let e=[],i=t.split(".."),n=+i[0],h=+i[1],r=n;if(n<h)for(;r<=h;r++)e.push(r);else for(;r>=h;r--)e.push(r);return e}_.prototype=v.prototype,_.class=v;class S{constructor({image:t,frameWidth:e,frameHeight:i,frameMargin:n,animations:h}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:e,height:i,margin:n},this._f=t.width/e|0,this.createAnimations(h)}createAnimations(t){let e,i;for(i in t){let{frames:n,frameRate:h,loop:r,flipX:s,flipY:a}=t[i];if(e=[],void 0===n)throw Error("Animation "+i+" must provide a frames property");[].concat(n).map(t=>{e=e.concat(b(t))}),this.animations[i]=_({spriteSheet:this,frames:e,frameRate:h,loop:r,flipX:s,flipY:a})}}}function M(t){return new S(t)}M.prototype=S.prototype,M.class=S;const A=()=>{};function R(){let t=a();o().clearRect(0,0,t.width,t.height)}function z(t){return new Promise(e=>{let i=new Image;i.src=t,i.onload=function(){e(i)}})}var k=i(1),E=i.n(k),I=i(2),P=i.n(I),T=i(3),O=i.n(T),D=i(4),L=i.n(D),X=(i(8),i(5)),Y=i.n(X),B=i(6),C=i.n(B);function j(){console.log("Background");const t=function(t,e){const i=document.createElement("canvas");i.width=t,i.height=e;const n=i.getContext("2d");n.beginPath(),n.fillStyle="midnightblue",n.rect(0,0,i.width,i.height),n.fill(),n.beginPath();for(let t=0;t<100;t++){let t=parseInt(Math.random()*i.width),e=parseInt(Math.random()*i.height),h=3*Math.random();n.arc(t,e,h,0,2*Math.PI,!1),n.closePath()}n.fillStyle="yellow",n.fill();const h=document.createElement("img");return h.src=i.toDataURL(),h}(a().width,a().height);return w({x:0,y:0,dx:-1,update(){this.advance(),this.x<=-t.width&&(this.x=0)},render(){this.context.drawImage(t,this.x,0),this.context.drawImage(t,t.width+this.x,0)}})}function W(){return function(){const t=a();return w({type:"description",x:0,y:0,height:t.height,width:t.width,opacity:0,render(){this.context.save(),this.context.globalAlpha=this.opacity,this.context.fillStyle=`rgba(0,0,0,${this.opacity})`,this.context.fillRect(this.x,this.y,this.width,this.height),this.context.font="24px Marker Felt",this.context.fillStyle="white",this.context.fillText("Marty! The Delorean needs fuel to bring you and Doc Brown back. Be Quick and collect 20 nuclear sticks",250,150),this.context.fillText("to get the Delorean running. But be carefull to not hit the moon or the sun!",250,190),this.context.restore()},update(){this.advance(),this.opacity<.75&&(this.opacity+=.02)}})}(a().width,a().height)}(async()=>{let{canvas:t,context:e}=function(t){if(!(n=document.getElementById(t)||t||document.querySelector("canvas")))throw Error("You must provide a canvas element for the game");return(h=n.getContext("2d")).imageSmoothingEnabled=!1,s("init"),{canvas:n,context:h}}();!function(){let t;for(t=0;t<26;t++)d[65+t]=(10+t).toString(36);for(t=0;t<10;t++)d[48+t]=""+t;window.addEventListener("keydown",f),window.addEventListener("keyup",u),window.addEventListener("blur",p)}(),document.querySelectorAll("canvas").forEach(t=>{t.width=window.innerWidth,t.height=window.innerHeight});let i=0,r=3,o=[];function c(){return o.find(t=>"description"===t.type)}function l(t,e,i){let n=w({type:"nuclearStick",x:t,y:e,width:50,height:50,dx:1.2*Math.random(),dy:1.2*Math.random(),update(){c()||this.advance()},render(){this.context.save(),this.context.strokeStyle=i,this.context.fillStyle="springgreen",this.context.shadowBlur=10,this.context.shadowColor="springgreen",this.context.fillRect(this.x,this.y,5,20),this.context.beginPath(),this.context.rect(this.x,this.y,5,20),this.context.stroke(),this.context.restore()}});o.push(n)}o.push(j());for(let t=0;t<20;t++)l(200,-10,"springgreen"),l(550,-10,"springgreen");const y=await z(E.a),x=await z(P.a),g=await z(O.a),v=await z(L.a),_=await z(Y.a),b=await z(C.a),S=M({image:y,type:"marty",frameWidth:50,frameHeight:52.5,flipX:!0,animations:{fly:{frames:"0..2",frameRate:3},fly2:{frames:"0..2",frameRate:3,flipX:!0},accelerate:{frames:"4..6",frameRate:3},speedDown1:{frames:"21..23",frameRate:3},flyDown:{frames:"36..38",frameRate:3},flyUp:{frames:"15..17",frameRate:3},salto:{frames:"43..52",frameRate:4,loop:!1},break:{frames:"58..59",frameRate:3},fall:{frames:"96..97",frameRate:4,loop:!1},die:{frames:"99..100",frameRate:4}}}),k=M({image:x,type:"doc",frameWidth:50,frameHeight:52.5,flipX:!0,animations:{talk:{frames:"2..3",frameRate:.5}}});function I(t,e,i){const n=w({type:i,x:t,y:e,width:130,height:130,radius:1,dx:-2*Math.random()-1,image:"sun"===i?g:v,update(){c()||(this.__proto__.update.call(this),this.x+this.width<=0&&(this.x=a().width+65,this.y=Math.random()*a().height))}});o.push(n)}function T(t,e){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y}for(let t=0;t<5;t++){let t=Math.random()*(.55*window.screen.width)+.3*window.screen.width,e=Math.random()*(.3*window.screen.height)+.5*window.screen.height,i=!0;for(;i;)i=!1,o.filter(t=>"sun"===t.type||"moon"===t.type).forEach(n=>{T(n,{x:t,y:e,height:300,width:300})&&(i=!0,t-=100,e-=100)});const n=["moon","sun"][Math.round(Math.random())];I(t,e,n)}let D=w({type:"delorean",x:.85*window.screen.width,y:.45*window.screen.height,image:_,render(){this.draw(),this.image===_&&(this.context.save(),this.context.font="16px Arial",this.context.fillStyle="red",this.context.fillText("Quick Marty, get in!",this.x,this.y-10),this.context.restore())}});function X(t){return t*Math.PI/180}const B=w({type:"marty",x:100,y:500,width:70,height:70,dx:0,dy:0,animations:S.animations,update(){if(this.advance(),B.dying)return;const t=Math.cos(X(this.rotation)),e=Math.sin(X(this.rotation));if(m("down"))this.x+=-1,this.y+=1.5,B.playAnimation("flyDown");else if(m("up"))this.x+=1,this.y+=-1.5,B.playAnimation("flyUp");else if(m("space")){let i=setInterval(()=>{this.y+=-4,this.ddx=.1*t,this.ddy=.1*e},100),n=setInterval(()=>{this.x+=1,this.y+=1.5,this.ddx=.1*t,this.ddy=.1*e},100);setTimeout(()=>clearInterval(i),1e3),setTimeout(()=>n(),1e3),setTimeout(()=>clearInterval(n),2e3),B.playAnimation("salto"),zzfx(.8,0,220,1,.1,1.2,0,0,0)}m("right")?(this.ddx=.05*t,this.ddy=.05*e,zzfx(1,.1,12,.4,.02,1.1,0,0,.22),B.playAnimation("fly")):m("left")?(this.ddx=-.05*t,this.ddy=-.05*e,B.playAnimation("fly2")):this.ddx=this.ddy=0}}),q=w({type:"doc",x:.8*window.screen.width,y:.4*window.screen.height,width:70,height:70,dx:0,dy:0,animations:k.animations,update(){this.advance(),q.playAnimation("talk")}});o.push(B),o.push(W()),a().addEventListener("click",function t(){console.log("REMOVE DESCR"),o=o.filter(t=>"description"!==t.type),a().removeEventListener("click",t)}),function({fps:t=60,clearCanvas:e=!0,update:i,render:n}={}){if(!i||!n)throw Error("You must provide update() and render() functions");let h,r,a,o,c,l=0,d=1e3/t,f=1/t,u=e?R:A;function p(){if(r=requestAnimationFrame(p),a=performance.now(),o=a-h,h=a,!(o>1e3)){for(s("tick"),l+=o;l>=d;)c.update(f),l-=d;u(),c.render()}}return c={update:i,render:n,isStopped:!0,start(){h=performance.now(),this.isStopped=!1,requestAnimationFrame(p)},stop(){this.isStopped=!0,cancelAnimationFrame(r)},_frame:p,set _last(t){h=t}}}({update:()=>{2===i&&o.push(D,q);for(let t=0;t<o.length;t++)if("nuclearStick"===o[t].type){for(let e=0;e<o.length;e++)if("marty"===o[e].type){let n=o[t],h=o[e];n.x,h.x,n.y,h.y;n.collidesWith(h)&&(n.ttl=0,i++,zzfx(1,.1,397,.5,.17,0,.1,0,.17))}}else if("marty"===o[t].type)for(let e=0;e<o.length;e++)if("sun"===o[e].type||"moon"===o[e].type){let i=o[t],n=o[e];i.x,n.x,i.y,n.y;i.collidesWith(n)&&(console.log("COLLISION"),1===r?setInterval(()=>{B.dx=0,B.y+=-1,B.playAnimation("die"),B.dying=!0},100):(B.playAnimation("fall"),r-=1,B.x=n.x-200,B.dx=0,zzfx(1,.1,52,.5,.26,.3,4.4,17.8,.03)))}else if("delorean"===o[e].type){let n=o[t],h=o[e],r=n.x-h.x,s=n.y-h.y;i>=2&&D.image===_&&Math.sqrt(r*r+s*s)<n.width+h.width-100&&(B.ttl=0,D.image=b,o=o.filter(t=>t!==q),setTimeout(()=>{D.ddx=.04},500))}(o=o.filter(t=>t.isAlive())).map(t=>t.update())},render:async()=>{o.map(t=>t.render()),e.font="16px Arial",e.fillStyle="deeppink",e.fillText("Score: "+i,8,20),e.font="16px Arial",e.fillStyle="yellow",e.fillText("Life-Energy: "+r,100,20)}}).start()})();i(9)}]);</script></body></html>